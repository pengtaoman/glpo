package main

import (
	"fmt"
	"runtime"
	"time"
)

func main() {

	var a [10]int
	for i := 0; i < 10; i++ {

		//没有参数i会报错，go run -race 命令查看数据冲突
		/**
		WARNING: DATA RACE
		Read at 0x00c00013c018 by goroutine 7:  被goroutine7 读取的数据
		Previous write at 0x00c00013c018 by main goroutine: 是被main写的，所以冲突
				**/
		go func(i int) {
			for {
				a[i]++

				/**
				加不加 runtime.Gosched() 的区别
				[76044372 74163550 76070382 86401145 78989556 73164950 86379060 84462719 136599931 156100345]

				[146029156 131914153 123357219 105194125 79096919 114897536 118023934 99859915 103746615 101737759]

				以下 加 runtime.Gosched()
				[802785 802131 799657 808452 802173 790442 799968 793297 785477 791921]
				[802785 802131 799657 808452 802173 790442 799968 793297 785477 791921]
				[826133 821559 825933 818284 820493 832790 820279 828311 817073 819013]
				[813769 787277 782079 772384 784826 803492 763314 813730 799986 781517]
				[830872 840904 817285 836856 809377 807870 831141 819056 827998 811674]

								**/
				runtime.Gosched()
			}
		}(i)
	}

	time.Sleep(time.Second)
	fmt.Println(a)
}
